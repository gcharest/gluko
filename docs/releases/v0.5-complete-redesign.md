# Release v0.5: Complete App Redesign + Performance Optimization

## Release Summary

Complete UI/UX redesign using modern, open-source design systems (Reka UI + Tailwind CSS) with mobile-first navigation patterns, while simultaneously implementing core performance optimizations (Web Workers, Service Worker caching, streaming imports) to achieve production-ready PWA performance and user experience.

**Status**: APPROVED - Current release target
**Supersedes**: v0.4 (PWA optimization) and original v0.5 (UI polish)
**Rationale**: Combining redesign with performance work minimizes rework and delivers both goals in a single cohesive release.

## Goals

### Primary Goals (Must Have)

1. **Modern Design System**: Migrate from Bootstrap to Reka UI + Tailwind CSS
   - Headless, accessible components (WCAG 2.1 AAA compliant)
   - Utility-first styling with full design control
   - Custom design tokens and theme system
   - Enhanced dark mode support

2. **Mobile-First Navigation**: Redesign app shell with thumb-friendly patterns
   - Bottom navigation bar (mobile) / Side rail (desktop)
   - Context-aware headers with dynamic actions
   - Eliminate hamburger menu in favor of persistent navigation
   - 4-5 core navigation items: Search, Calculator, History, Profile

3. **View Redesigns**: Rebuild all core views with modern UX patterns
   - **Search**: Autocomplete, recent searches, favorites, compact results
   - **Calculator**: Sticky totals, swipe-to-delete, serving size picker
   - **History**: Timeline layout, swipe actions, quick duplicate
   - **Profile/Settings**: Organized sections, clear subject management

4. **Performance Optimization**: Non-blocking dataset loading and app interactions
   - Web Workers for shard parsing and IndexedDB writes
   - Streaming NDJSON ingestion with chunked transactions
   - Service Worker caching for offline repeats
   - Target: LCP < 2.5s, FCP < 1.8s, TBT < 200ms

5. **Accessibility Excellence**: Production-ready accessibility across all views
   - WCAG AA+ compliance (target: AAA where feasible)
   - Enhanced keyboard navigation and focus management
   - Screen reader optimization with live regions
   - Respect `prefers-reduced-motion` system setting

### Secondary Goals (Should Have)

1. **Micro-interactions**: Subtle animations and feedback for better UX
2. **Enhanced loading states**: Skeleton screens, progress indicators
3. **Storage management**: Quota display, cleanup options, low-storage warnings

## Constraints Specific to This Release

- **Data preservation**: All v0.3 IndexedDB data (meal history, datasets) must migrate cleanly
- **Composable preservation**: Keep all v0.3 data composables (`useShardLoader`, `useIndexedDB`, `useStorageQuota`) unchanged
- **No new features**: Focus is redesign + optimization, not new functionality
- **Static hosting**: Still using GitHub Pages, no backend changes
- **Mobile networks**: Design for 3G, rural areas, spotty connections
- **Low-end devices**: Must work on < 4GB RAM devices
- **Bilingual-first**: All new UI must work equally well in EN/FR

## Options Considered

### Option A: v0.4 first, then redesign later

- **Approach**: Implement Web Workers and streaming with Bootstrap UI, then migrate to Reka UI + Tailwind
- **Pros**: Incremental, lower risk per release
- **Cons**: Double work (optimize Bootstrap components, then throw away), 3-6 weeks wasted effort
- **Risk**: Medium - safe but inefficient

### Option B: Redesign first, then v0.4 later

- **Approach**: Full UI migration, then add performance optimizations to new design
- **Pros**: Clean foundation, no throwaway work
- **Cons**: Long release cycle without performance wins
- **Risk**: Medium - delays performance improvements

### Option C: Combined redesign + optimization (SELECTED)

- **Approach**: Rebuild UI with Reka UI + Tailwind while simultaneously implementing Web Workers, streaming, and Service Worker caching
- **Pros**:
  - Minimizes rework (build performance features once in final UI)
  - Delivers both UX and performance improvements together
  - Saves 3-6 weeks compared to sequential approach
  - Perfect timing (v0.3 data layer is stable and design-agnostic)
- **Cons**: Larger release scope, longer cycle time for single release
- **Risk**: Medium - more complex but well-scoped

## Selected: Option C (Combined Release)

**Why**: The v0.3 data layer (composables, stores, IndexedDB) is completely decoupled from the UI. The redesign primarily affects presentation, not data management. By combining both efforts, we:

1. Build Web Workers and streaming with the **final** UI components (no rework)
2. Implement progress indicators **once** in the production design system
3. Avoid optimizing Bootstrap components that will be discarded
4. Ship a production-ready PWA in one cohesive release

**Trade-off**: Longer release cycle (~10-12 weeks vs 3-4 weeks for v0.4 alone), but total time to both goals is shorter.

## Success Criteria

### Design System Migration

- [ ] Reka UI + Tailwind CSS installed and configured
- [ ] Design tokens established (colors, typography, spacing, shadows)
- [ ] Base component library created (Button, Input, Card, Modal, etc.)
- [ ] Dark mode system implemented with Light/Dark/System options
- [ ] Bootstrap completely removed from dependencies

### Navigation & Shell

- [ ] Bottom navigation (mobile) / Side rail (desktop) implemented
- [ ] All core views accessible via persistent navigation
- [ ] Context-aware headers with dynamic actions
- [ ] Smooth transitions between views
- [ ] Routing updated for new navigation patterns

### View Redesigns

- [ ] Search: Autocomplete, recent searches, favorites, compact result cards
- [ ] Calculator: Sticky totals header, swipe-to-delete items, serving size modal
- [ ] History: Timeline layout with date sections, swipe actions, detail modals
- [ ] Profile: Organized sections (subjects, data, preferences, about)

### Performance Optimization (v0.4 goals)

- [ ] Web Worker implemented for shard parsing and IndexedDB writes
- [ ] Streaming NDJSON ingestion (non-blocking main thread)
- [ ] Chunked IndexedDB transactions (500-2000 records per batch)
- [ ] Service Worker caching strategy for manifest and shards
- [ ] Zero downloads on repeat visits (unchanged manifest)
- [ ] LCP < 2.5s, FCP < 1.8s, TBT < 200ms on mid-tier device
- [ ] App shell interactive before dataset import completes
- [ ] Import throughput â‰¥ 5,000 records/sec

### Accessibility

- [ ] Lighthouse accessibility score â‰¥ 95
- [ ] Keyboard navigation works throughout app
- [ ] Focus indicators visible and high-contrast (2px outline)
- [ ] Screen reader tested with NVDA/JAWS
- [ ] Live regions announce dynamic content updates
- [ ] WCAG AA contrast ratios (4.5:1 for text)
- [ ] Touch targets â‰¥ 44Ã—44px
- [ ] `prefers-reduced-motion` respected

### Performance & Bundle Size

- [ ] Initial JS bundle < 150 KB gzipped
- [ ] CSS < 30 KB gzipped (Tailwind purged)
- [ ] Route-based code splitting implemented
- [ ] Tree-shaking verified (Reka UI, Lucide Icons)
- [ ] Performance budgets enforced in CI

### Compatibility & Testing

- [ ] Works offline after initial dataset load
- [ ] Interrupted downloads can resume
- [ ] Storage quota checked before downloads
- [ ] Cross-browser tested (Chrome, Firefox, Safari, Edge)
- [ ] Mobile tested (iOS Safari, Android Chrome)
- [ ] Low-end device tested (< 4GB RAM)

## Known Risks

### Design System Migration Risks

- **Risk**: Reka UI component patterns differ from Bootstrap â†’ Learning curve
- **Mitigation**: Excellent documentation available, gradual migration view-by-view

- **Risk**: Tailwind utility classes verbose â†’ Bundle size concerns
- **Mitigation**: PurgeCSS removes unused classes, production builds optimized

- **Risk**: Custom components require more code than Bootstrap â†’ Development time
- **Mitigation**: Build reusable base components first, then compose views

### Performance Risks

- **Risk**: Web Worker overhead on very low-end devices
- **Mitigation**: Graceful fallback to main-thread import if Worker fails

- **Risk**: Service Worker caching complexity â†’ Cache invalidation bugs
- **Mitigation**: Clear cache versioning strategy, manifest-based validation

- **Risk**: Chunked writes slower than bulk writes â†’ Longer import times
- **Mitigation**: Tune chunk size per device performance (500-2000 records)

### Scope & Timeline Risks

- **Risk**: Combined release takes longer â†’ Users wait for improvements
- **Mitigation**: Acceptable for v0.5 pre-production phase; delivers more value when shipped

- **Risk**: Scope creep during redesign â†’ Feature additions sneak in
- **Mitigation**: Strict rule: "Same functionality, better UI". No new features.

- **Risk**: Testing burden increases â†’ Longer QA cycle
- **Mitigation**: Automated tests (unit, integration, E2E) catch regressions early

### Migration Risks

- **Risk**: Existing v0.3 data doesn't migrate cleanly
- **Mitigation**: IndexedDB schema unchanged; composables remain identical

- **Risk**: i18n translations break with new component structure
- **Mitigation**: Maintain same translation keys, update component bindings only

## Out of Scope

The following are **explicitly excluded** from v0.5:

- âŒ New features (favorites, tags, notes, export) â†’ v0.6+
- âŒ Backend or cloud sync â†’ Future consideration
- âŒ Compression or binary formats (Parquet) â†’ Future optimization
- âŒ Automatic background dataset updates â†’ v0.7+
- âŒ Theme customization (custom colors, fonts) â†’ Nice-to-have for v1.0
- âŒ Advanced analytics or meal insights â†’ Future feature
- âŒ Multi-language beyond EN/FR â†’ v1.0+
- âŒ Per-shard lazy loading â†’ Full dataset loaded on sync

## Phased Implementation Plan

### Phase 1: Foundation (Weeks 1-3)

**Goal**: Set up new design system and base components

- Install dependencies (Reka UI, Tailwind CSS, Lucide Icons)
- Configure Tailwind with design tokens
- Create base component library (Button, Input, Card, Modal, Badge, etc.)
- Set up dark mode system
- Create new app shell with bottom nav / side rail
- Update routing for new navigation pattern
- **Deliverable**: App shell renders with new navigation, old views still work

### Phase 2: Core View Redesigns (Weeks 4-7)

**Goal**: Rebuild each view with new design system

**Week 4: Search View**

- New search input with autocomplete
- Recent searches list
- Favorites toggle and display
- Compact result cards with inline actions
- **Deliverable**: Functional search with new UI

**Week 5: Calculator View**

- Sticky total header
- Meal item cards with swipe-to-delete
- Serving size picker modal
- Add food flow (search drawer)
- **Deliverable**: Functional calculator with new UI

**Week 6: History View**

- Timeline layout with date sections
- Compact meal cards
- Swipe actions (duplicate, delete)
- Detail modal with full nutrient breakdown
- **Deliverable**: Functional history with new UI

**Week 7: Profile/Settings View**

- Subject management section
- Data & privacy section
- Preferences section (language, theme, units)
- About section
- Storage quota display
- **Deliverable**: All views redesigned, Bootstrap removed

### Phase 3: Performance Optimization (Weeks 8-10)

**Goal**: Implement v0.4's Web Worker and Service Worker patterns

**Week 8: Web Worker Implementation**

- Create dedicated worker for shard processing
- Implement streaming NDJSON parsing in worker
- Message protocol between main thread and worker
- Progress reporting from worker to UI
- **Deliverable**: Non-blocking shard imports

**Week 9: Chunked IndexedDB Writes**

- Implement chunked transaction writes (tunable batch size)
- Add progress tracking per chunk
- Error handling and retry logic
- Resumability after interruption
- **Deliverable**: Efficient, non-blocking IndexedDB imports

**Week 10: Service Worker Caching**

- Enhanced Service Worker with cache strategy
- Cache manifest and shards for offline use
- Cache versioning and invalidation
- Offline indicator in UI
- **Deliverable**: Zero downloads on repeat visits, offline support

### Phase 4: Polish & Testing (Weeks 11-12)

**Goal**: Accessibility, performance tuning, cross-browser testing

**Week 11: Accessibility & Animations**

- Keyboard navigation audit and fixes
- Screen reader testing (NVDA/JAWS)
- Focus management in modals and drawers
- Add micro-interactions and animations
- `prefers-reduced-motion` support
- **Deliverable**: WCAG AA+ compliant, polished interactions

**Week 12: Performance & Testing**

- Web Vitals optimization (LCP, FCP, TBT targets)
- Bundle size optimization (code splitting, tree-shaking)
- Cross-browser testing (Chrome, Firefox, Safari, Edge)
- Mobile device testing (iOS, Android)
- Low-end device testing
- E2E test suite updates
- **Deliverable**: Production-ready v0.5

### Phase 5: Documentation & Release (Week 13)

- Update user documentation
- Update developer documentation
- Create migration guide from v0.3 to v0.5
- Prepare release notes
- Deploy to production
- **Deliverable**: v0.5 shipped ðŸš€

## Dependencies & Prerequisites

### Required Before Starting

- âœ… v0.3 completed and stable (shard loading, manifest, IndexedDB v3)
- âœ… Current app functional with Bootstrap UI
- âœ… i18n infrastructure in place (EN/FR)
- âœ… Testing infrastructure (Vitest, Playwright)

### External Dependencies

- Reka UI (MIT license) - v2.x latest
- Tailwind CSS (MIT license) - v3.x latest
- Lucide Icons (ISC license) - Latest stable
- VueUse (MIT license) - For dark mode and utilities

### Team Prerequisites

- Familiarity with Tailwind utility classes
- Understanding of headless UI component patterns
- Web Worker and Service Worker experience (or willingness to learn)
- Accessibility testing knowledge (WCAG guidelines, screen readers)

## Migration Strategy

### For Developers

**Data Layer (No Changes)**:

- Keep all v0.3 composables unchanged
- Preserve Pinia stores (meal, mealHistory, nutrient, subject)
- Maintain IndexedDB schema (v3)
- Keep i18n structure and translation keys

**Presentation Layer (Complete Rewrite)**:

- Replace Bootstrap components with Reka UI equivalents
- Convert Bootstrap classes to Tailwind utilities
- Rebuild Vue templates (same data bindings, new markup)
- Update component props/events (same logic, new patterns)

### For Users

- **Seamless data migration**: All meal history, subjects, and datasets preserved
- **Visual change only**: Same features, better UI
- **One-time re-download**: Service Worker cache cleared, dataset re-imported with new caching strategy
- **No action required**: Automatic upgrade on next app visit

## What v0.5 Enables

With v0.5 complete, Gluko will have:

1. **Production-Ready UI**: Modern, accessible, mobile-first design that feels professional and trustworthy
2. **Excellent Performance**: Non-blocking imports, fast load times, smooth interactions
3. **Offline-First**: Zero downloads on repeat visits, full offline functionality
4. **Accessibility**: WCAG AA+ compliant with excellent keyboard and screen reader support
5. **Maintainable Codebase**: Clean separation of concerns, reusable components, utility-first styling

This provides a solid foundation for:

- **v0.6**: New features (favorites, tags, notes, export/import)
- **v0.7**: Advanced search, meal templates, analytics
- **v1.0**: Production release with comprehensive feature set

## Related Documentation

- **Superseded releases**:
  - [v0.4-pwa-optimization.md](v0.4-pwa-optimization.md) â†’ Deprecated (merged into v0.5)
  - [v0.5-ui-polish.md](v0.5-ui-polish.md-DEPRECATED) â†’ Deprecated (replaced by complete redesign)
- **Design proposal**: [v0.x-complete-redesign-proposal.md](v0.x-complete-redesign-proposal.md)
- **Previous release**: [v0.3-shard-loading.md](v0.3-shard-loading.md)
- **Implementation guide**: [v0.5-complete-redesign-implementation.md](../implementation/v0.5-complete-redesign-implementation.md)
- **Release tracker**: [RELEASE_TRACKER.md](RELEASE_TRACKER.md)
- **Next release**: [v0.6-feature-enhancements.md](v0.6-feature-enhancements.md)
- Product goals: [PRODUCT.md](../PRODUCT.md)
- Architecture: [ARCHITECTURE.md](../ARCHITECTURE.md)

## Decision Log

**2025-12-19**: Decision to combine v0.4 (performance) with redesign proposal into single v0.5 release

- **Reason**: Minimize rework by building performance optimizations with final UI from the start
- **Trade-off**: Longer single release cycle (~12 weeks) vs incremental releases, but 3-6 weeks saved overall
- **Stakeholder**: Development team consensus
- **Alternative considered**: Sequential v0.4 â†’ redesign later (rejected due to duplicate effort)
