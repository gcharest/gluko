# Release v0.1: MVP Foundation

## Release Summary

Establish core application foundation with functional carb calculator, nutrient search, multi-subject tracking, and persistent data storage using IndexedDB for offline-first operation.

## Goals

1. **Core application structure**: Vue 3 + TypeScript + Vite with strict typing
2. **Data persistence**: IndexedDB integration with multi-store schema
3. **Nutrient search**: Fuzzy search across Canadian Nutrient File (~7000 foods)
4. **Multi-subject support**: Track meals for multiple people with persistent history
5. **Bilingual interface**: Complete EN/FR localization via vue-i18n
6. **Basic PWA setup**: Service Worker registration configured (vite-plugin-pwa)
7. **Testing framework**: Vitest + Playwright + accessibility testing

## What Was Built

### Core Infrastructure

- **Vue 3 Composition API** with TypeScript strict mode
- **Pinia state management** with 5 stores:
  - `nutrientsFile`: Dataset storage and search
  - `meal`: Current meal calculation
  - `mealHistory`: Persistent meal records
  - `subject`: Multi-subject management
  - `session`: Session tracking
- **Vue Router** for navigation between views
- **Bootstrap 5** for responsive UI
- **vue-i18n** for bilingual support (EN/FR)

### Data Layer

- **IndexedDB** via `useIndexedDB` composable with comprehensive schema:
  - `nutrientsFile` store (dataset, key: 0)
  - `favoriteNutrients` store (favorites, key: 'current')
  - `subjects` store (multi-subject tracking with indexes)
  - `sessions` store (session management)
  - `mealHistory` store (complete meal data with all nutrients)
- **Proper indexing**: `by-subject`, `by-date`, `by-active`, `by-name`
- **Date serialization/deserialization** for IndexedDB compatibility
- **Error handling**: QuotaExceededError, SecurityError, etc.
- **Transaction atomicity**: Multi-operation scenarios combine into single transactions (e.g., add meal + update subject stats)
- **Continuous data persistence**: Updates happen during user interaction, NOT on unload (prevents data loss)

### Dataset & Search

- **Canadian Nutrient File** (CNF) dataset:
  - ~7000 food records
  - Loaded from single JSON file (`src/assets/canadian_nutrient_file.json`)
  - Includes: Protein (203), Fat (204), Carbs (205), Fiber (291), FctGluc
  - Bilingual descriptions (FoodDescription + FoodDescriptionF)
- **Fuse.js fuzzy search** with:
  - Configurable thresholds and options
  - In-memory caching for repeated searches
  - Search across both EN/FR descriptions
- **Favorites system**: Persistent storage of favorite foods

### Calculator & History

- **Multi-subject tracking**:
  - Create multiple subjects (self + caregivers tracking others)
  - Switch between subjects
  - Each subject has independent meal history
- **Meal calculator**:
  - Add foods to current meal
  - Calculate nutritional breakdown (carbs, protein, fat, fiber)
  - Support for serving sizes
- **Complete meal history persistence**:
  - All meal details stored (foods, nutrients, serving sizes)
  - Retrievable by subject and date
  - No data loss across app restarts

### UI Components & Views

- **Base components**:
  - `BaseFooter.vue` (with unit test)
  - `BaseNavigationBar.vue` (with unit test)
- **View structure**:
  - Search view
  - Calculator view
  - History view
  - Settings/subject management
- **Responsive design**: Mobile-first Bootstrap layouts

### Testing & Quality

- **Vitest** for unit testing with @vitest/coverage-v8
- **Playwright** for E2E testing with @axe-core/playwright
- **3 E2E test files**:
  - `accessibility.spec.ts`: Accessibility validation
  - `installation.spec.ts`: PWA installation flow
  - `vue.spec.ts`: Basic Vue functionality
- **2 component unit tests**: BaseFooter, BaseNavigationBar
- **CI/CD workflows**: accessibility, code-quality, codeql-analysis, deploy

### PWA Setup

- **vite-plugin-pwa** installed and configured
- **Service Worker registration**: `registerType: 'prompt'`
- **Workbox configuration**: 3MB cache limit
- **manifest.json**: Deferred to v0.2
- **PWA icons**: Deferred to v0.2
- **Offline validation**: Basic SW functional; comprehensive testing in v0.2

## Technical Considerations

### TypeScript & Vue 3 Best Practices

- **Strict Mode**: All code compiled with TypeScript strict mode enforced
- **Composable Return Types**: `useIndexedDB` and all composables have explicit return types for IDE autocomplete and type safety
- **Store Mutations**: Pinia stores use TypeScript interfaces for all mutations and getters
- **Component Props**: All Vue components use `<script setup>` with explicit TypeScript prop interfaces
- **Reactivity Pattern**: Consistent use of `ref<T>` for reactive values (not `reactive()`) for better TypeScript inference

### IndexedDB Best Practices

- **Transaction Atomicity**: Multi-operation scenarios (e.g., add meal + update subject stats) combine into single transactions to ensure consistency if browser crashes
- **Continuous Persistence**: Data updates happen during user interaction via Pinia store mutations, NOT tied to unload events (prevents data loss from aborted transactions)
- **Date Serialization**: Dates stored as ISO strings in IndexedDB; automatically converted to/from Date objects in memory
- **Error Handling**: QuotaExceededError and SecurityError caught; user notified with remediation options

### Known Limitations

- Search cache grows indefinitely without LRU eviction
- Dataset loading is synchronous and blocks store initialization
- No dataset versioning or update detection mechanism
- No IndexedDB migration strategy for schema changes
- Error handling could provide better user feedback (addressed in v0.2)

## Design Constraints

- **No backend**: All data and logic client-side
- **Offline data**: Dataset persists in IndexedDB
- **Mobile storage**: Single-file approach keeps initial payload manageable
- **Data source**: Canadian Nutrient File (Health Canada)
- **Bilingual**: Full EN/FR support

## Success Criteria

- Search returns foods in < 2 seconds
- Carb calculator works accurately (validated against CNF data)
- Full dataset loads and persists via IndexedDB
- Service Worker registration configured
- Lighthouse accessibility score â‰¥ 95
- Multi-subject tracking stores and retrieves meal history
- Bilingual interface (EN/FR) fully functional
- Works offline for search, calculation, and history viewing

## Out of Scope

- PWA installation (manifest.json, icons)
- Comprehensive test coverage
- Performance monitoring and optimization
- Dataset sharding or versioning
- Advanced UI refinements
- History export/import functionality

## Related Documentation

- **Next release**: [v0.2-pwa-installability.md](v0.2-pwa-installability.md)
- **Feature tracker**: [RELEASE_TRACKER.md](RELEASE_TRACKER.md)
- **Product vision**: [../PRODUCT.md](../PRODUCT.md)
- **Architecture**: [../ARCHITECTURE.md](../ARCHITECTURE.md)
